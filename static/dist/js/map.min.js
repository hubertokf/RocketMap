/*
 pogomap 2017-08-08 
*/

"use strict";function excludePokemon(e){$selectExclude.val($selectExclude.val().concat(e)).trigger("change")}function notifyAboutPokemon(e){$selectPokemonNotify.val($selectPokemonNotify.val().concat(e)).trigger("change")}function removePokemonMarker(e){mapData.pokemons[e].marker.rangeCircle&&(mapData.pokemons[e].marker.rangeCircle.setMap(null),delete mapData.pokemons[e].marker.rangeCircle),mapData.pokemons[e].marker.setMap(null),mapData.pokemons[e].hidden=!0}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:Number(getParameterByName("lat"))||centerLat,lng:Number(getParameterByName("lon"))||centerLng},zoom:Number(getParameterByName("zoom"))||Store.get("zoomLevel"),fullscreenControl:!0,streetViewControl:!1,mapTypeControl:!1,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.RIGHT_TOP,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,"nolabels_style","dark_style","style_light2","style_pgo","dark_style_nl","style_light2_nl","style_pgo_nl","style_pgo_day","style_pgo_night","style_pgo_dynamic"]}});var e={imagePath:"static/images/cluster/m",maxZoom:Store.get("maxClusterZoomLevel"),zoomOnClick:Store.get("clusterZoomOnClick"),gridSize:Store.get("clusterGridSize")};markerCluster=new MarkerClusterer(map,[],e);var t=new google.maps.StyledMapType(noLabelsStyle,{name:"No Labels"});map.mapTypes.set("nolabels_style",t);var n=new google.maps.StyledMapType(darkStyle,{name:"Dark"});map.mapTypes.set("dark_style",n);var a=new google.maps.StyledMapType(light2Style,{name:"Light2"});map.mapTypes.set("style_light2",a);var o=new google.maps.StyledMapType(pGoStyle,{name:"RocketMap"});map.mapTypes.set("style_pgo",o);var i=new google.maps.StyledMapType(darkStyleNoLabels,{name:"Dark (No Labels)"});map.mapTypes.set("dark_style_nl",i);var s=new google.maps.StyledMapType(light2StyleNoLabels,{name:"Light2 (No Labels)"});map.mapTypes.set("style_light2_nl",s);var r=new google.maps.StyledMapType(pGoStyleNoLabels,{name:"RocketMap (No Labels)"});map.mapTypes.set("style_pgo_nl",r);var l=new google.maps.StyledMapType(pGoStyleDay,{name:"RocketMap Day"});map.mapTypes.set("style_pgo_day",l);var c=new google.maps.StyledMapType(pGoStyleNight,{name:"RocketMap Night"});map.mapTypes.set("style_pgo_night",c);var p=(new Date).getHours(),d=p>=6&&p<19?l:c;map.mapTypes.set("style_pgo_dynamic",d),map.addListener("maptypeid_changed",function(e){Store.set("map_style",this.mapTypeId)}),map.setMapTypeId(Store.get("map_style")),map.addListener("idle",updateMap),map.addListener("zoom_changed",function(){!0===storeZoom?Store.set("zoomLevel",this.getZoom()):storeZoom=!0,redrawTimeout&&(clearTimeout(redrawTimeout),redrawTimeout=null),redrawTimeout=setTimeout(function(){redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons),markerCluster.resetViewport(),markerCluster.redraw()},500)}),searchMarker=createSearchMarker(),locationMarker=createLocationMarker(),createMyLocationButton(),initSidebar(),$("#scan-here").on("click",function(){var e=map.getCenter();changeLocation(e.lat(),e.lng()),$("#search-switch").checked||($("#search-switch").prop("checked",!0),searchControl("on"))})}function updateLocationMarker(e){if(e in searchMarkerStyles){var t=searchMarkerStyles[e].icon;t?locationMarker.setIcon({url:t,scaledSize:new google.maps.Size(24,24)}):locationMarker.setIcon(t),Store.set("locationMarkerStyle",e)}return locationMarker}function createLocationMarker(){var e=Store.get("followMyLocationPosition"),t="lat"in e?e.lat:centerLat,n="lng"in e?e.lng:centerLng,a=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:{lat:t,lng:n},draggable:!0,icon:null,optimized:!1,zIndex:google.maps.Marker.MAX_ZINDEX+2});return a.infoWindow=new google.maps.InfoWindow({content:"<div><b>My Location</b></div>",disableAutoPan:!0}),addListeners(a),google.maps.event.addListener(a,"dragend",function(){var e=a.getPosition();Store.set("followMyLocationPosition",{lat:e.lat(),lng:e.lng()})}),a}function updateSearchMarker(e){if(e in searchMarkerStyles){var t=searchMarkerStyles[e].icon;t?searchMarker.setIcon({url:t,scaledSize:new google.maps.Size(24,24)}):searchMarker.setIcon(t),Store.set("searchMarkerStyle",e)}return searchMarker}function createSearchMarker(){var e=new google.maps.Marker({position:{lat:centerLat,lng:centerLng},map:map,animation:google.maps.Animation.DROP,draggable:!Store.get("lockMarker"),icon:null,optimized:!1,zIndex:google.maps.Marker.MAX_ZINDEX+1});e.infoWindow=new google.maps.InfoWindow({content:"<div><b>Search Location</b></div>",disableAutoPan:!0}),addListeners(e);var t=null;return google.maps.event.addListener(e,"dragstart",function(){t=e.getPosition()}),google.maps.event.addListener(e,"dragend",function(){var n=e.getPosition();changeSearchLocation(n.lat(),n.lng()).done(function(){t=null}).fail(function(){t&&e.setPosition(t)})}),e}function searchControl(e){$.post(searchControlURI+"?action="+encodeURIComponent(e)),$("#scan-here").toggleClass("disabled","off"===e)}function updateSearchStatus(){$.getJSON(searchControlURI).then(function(e){$("#search-switch").prop("checked",e.status),$("#scan-here").toggleClass("disabled",!e.status)})}function initSidebar(){$("#gyms-switch").prop("checked",Store.get("showGyms")),$("#gym-sidebar-switch").prop("checked",Store.get("useGymSidebar")),$("#gym-sidebar-wrapper").toggle(Store.get("showGyms")),$("#gyms-filter-wrapper").toggle(Store.get("showGyms")),$("#team-gyms-only-switch").val(Store.get("showTeamGymsOnly")),$("#raids-switch").prop("checked",Store.get("showRaids")),$("#raid-active-gym-switch").prop("checked",Store.get("showActiveRaidsOnly")),$("#raid-min-level-only-switch").val(Store.get("showRaidMinLevel")),$("#raid-max-level-only-switch").val(Store.get("showRaidMaxLevel")),$("#raids-filter-wrapper").toggle(Store.get("showRaids")),$("#open-gyms-only-switch").prop("checked",Store.get("showOpenGymsOnly")),$("#min-level-gyms-filter-switch").val(Store.get("minGymLevel")),$("#max-level-gyms-filter-switch").val(Store.get("maxGymLevel")),$("#last-update-gyms-switch").val(Store.get("showLastUpdatedGymsOnly")),$("#pokemon-switch").prop("checked",Store.get("showPokemon")),$("#pokestops-switch").prop("checked",Store.get("showPokestops")),$("#lured-pokestops-only-switch").val(Store.get("showLuredPokestopsOnly")),$("#lured-pokestops-only-wrapper").toggle(Store.get("showPokestops")),$("#geoloc-switch").prop("checked",Store.get("geoLocate")),$("#lock-marker-switch").prop("checked",Store.get("lockMarker")),$("#start-at-user-location-switch").prop("checked",Store.get("startAtUserLocation")),$("#follow-my-location-switch").prop("checked",Store.get("followMyLocation")),$("#scan-here-switch").prop("checked",Store.get("scanHere")),$("#scan-here").toggle(Store.get("scanHere")),$("#scanned-switch").prop("checked",Store.get("showScanned")),$("#spawnpoints-switch").prop("checked",Store.get("showSpawnpoints")),$("#ranges-switch").prop("checked",Store.get("showRanges")),$("#sound-switch").prop("checked",Store.get("playSound")),$("#pokemoncries").toggle(Store.get("playSound")),$("#cries-switch").prop("checked",Store.get("playCries"));var e=document.getElementById("next-location");if(e){var t=new google.maps.places.Autocomplete(e);$(e).css("background-color",$("#geoloc-switch").prop("checked")?"#e0e0e0":"#ffffff"),t.addListener("place_changed",function(){var e=t.getPlace();if(e.geometry){var n=e.geometry.location;changeLocation(n.lat(),n.lng())}})}$("#search-switch").length&&(updateSearchStatus(),setInterval(updateSearchStatus,5e3)),$("#pokemon-icon-size").val(Store.get("iconSizeModifier"))}function getTypeSpan(e){return"<span style='padding: 2px 5px; text-transform: uppercase; color: white; margin-right: 2px; border-radius: 4px; font-size: 0.6em; vertical-align: middle; background-color: "+e.color+"'>"+e.type+"</span>"}function openMapDirections(e,t){var n="https://www.google.com/maps/?daddr="+e+","+t;window.open(n,"_blank")}function getDateStr(e){var t="Unknown";return e&&(t=moment(e).fromNow()),t}function pokemonLabel(e){var t=e.pokemon_name,n=e.pokemon_rarity?"("+e.pokemon_rarity+")":"",a=e.pokemon_types,o="",i=e.encounter_id,s=e.pokemon_id,r=e.latitude,l=e.longitude,c=e.disappear_time,p=e.individual_attack,d=e.individual_defense,m=e.individual_stamina,g=void 0!==moves[e.move_1]?i8ln(moves[e.move_1].name):"gen/unknown",u=void 0!==moves[e.move_2]?i8ln(moves[e.move_2].name):"gen/unknown",k=e.weight,h=e.height,v=e.gender,y=e.form,f=e.cp,w=e.cp_multiplier;$.each(a,function(e,t){o+=getTypeSpan(t)});var S="",M="",_="";if(201===s&&null!==y&&y>0&&(_+="("+unownForm[e.form]+")"),M+="\n    <div class='pokemon name'>\n      "+t+" <span class='pokemon name pokedex'><a href='http://pokemon.gameinfo.io/en/pokemon/"+s+"' target='_blank' title='View in Pokédex'>#"+s+"</a></span> "+_+" <span class='pokemon gender rarity'>"+genderType[v-1]+" "+n+"</span> "+o+"\n    </div>",null!==f&&null!==w){var L=getPokemonLevel(w);if(null!==p&&null!==d&&null!==m)var P=getIv(p,d,m);M+="\n          <div class='pokemon container'>\n            <div class='pokemon container content-left'>\n              <div>\n                <img class='pokemon sprite' src='static/icons/"+s+".png'>\n                <span class='pokemon'>Level: </span><span class='pokemon'>"+L+"</span>\n                <span class='pokemon links exclude'><a href='javascript:excludePokemon("+s+")'>Exclude</a></span>\n                <span class='pokemon links notify'><a href='javascript:notifyAboutPokemon("+s+")'>Notify</a></span>\n                <span class='pokemon links remove'><a href='javascript:removePokemonMarker(\""+i+"\")'>Remove</a></span>\n              </div>\n          </div>\n          <div class='pokemon container content-right'>\n            <div>\n              <div class='pokemon disappear'>\n                <span class='label-countdown' disappears-at='"+c+"'>00m00s</span> left\n              </div>\n              <div class='pokemon'>\n                CP: <span class='pokemon encounter'>"+f+"/"+P.toFixed(1)+"%</span> (A"+p+"/D"+d+"/S"+m+")\n              </div>\n              <div class='pokemon'>\n                Moveset: <span class='pokemon encounter'>"+g+"/"+u+"</span>\n              </div>\n              <div class='pokemon'>\n                Weight: "+k.toFixed(2)+"kg | Height: "+h.toFixed(2)+"m\n              </div>\n              <div>\n                <span class='pokemon navigate'><a href='javascript:void(0);' onclick='javascript:openMapDirections("+r+","+l+");' title='Open in Google Maps'>"+r.toFixed(6)+", "+l.toFixed(7)+"</a></span>\n              </div>\n          </div>\n        </div>\n      </div>"}else M+="\n      <div class='pokemon container'>\n        <div class='pokemon container content-left'>\n          <div>\n            <img class='pokemon sprite' src='static/icons/"+s+".png'>\n            <span class='pokemon'>Level: </span><span class='pokemon no-encounter'>n/a</span>\n            <span class='pokemon links exclude'><a href='javascript:excludePokemon("+s+")'>Exclude</a></span>\n            <span class='pokemon links notify'><a href='javascript:notifyAboutPokemon("+s+")'>Notify</a></span>\n            <span class='pokemon links remove'><a href='javascript:removePokemonMarker(\""+i+"\")'>Remove</a></span>\n          </div>\n      </div>\n      <div class='pokemon container content-right'>\n        <div>\n          <div class='pokemon disappear'>\n            <span class='label-countdown' disappears-at='"+c+"'>00m00s</span> left\n          </div>\n          <div class='pokemon'>\n            CP: <span class='pokemon no-encounter'>No information</span>\n          </div>\n          <div class='pokemon'>\n            Moveset: <span class='pokemon no-encounter'>No information</span>\n          </div>\n          <div class='pokemon'>\n            Weight: <span class='pokemon no-encounter'>n/a</span> | Height: <span class='pokemon no-encounter'>n/a</span>\n          </div>\n          <div>\n            <span class='pokemon navigate'><a href='javascript:void(0);' onclick='javascript:openMapDirections("+r+","+l+");' title='Open in Google Maps'>"+r.toFixed(6)+", "+l.toFixed(7)+"</a></span>\n          </div>\n      </div>\n    </div>\n  </div>";return M+="\n      "}function isOngoingRaid(e){return e&&Date.now()<e.end&&Date.now()>e.start}function isValidRaid(e){return e&&Date.now()<e.end&&Date.now()>e.spawn}function isGymSatisfiesRaidMinMaxFilter(e){return null===e?0:e.level<=Store.get("showRaidMaxLevel")&&e.level>=Store.get("showRaidMinLevel")?1:0}function gymLabel(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[3,6,9,59,65,68,89,94,103,110,112,125,126,129,131,134,135,136,143,144,145,146,153,156,159,248,249],a=e.raid,o="";if(a&&a.end>Date.now()&&null!==a.pokemon_id){var i=void 0!==moves[a.move_1]?i8ln(moves[a.move_1].name):"unknown",s=void 0!==moves[a.move_2]?i8ln(moves[a.move_2].name):"unknown";o+="\n                    <div class='move'>\n                      <span class='name'>"+i+"</span><span class='type "+moves[a.move_1].type.toLowerCase()+"'>"+i8ln(moves[a.move_1].type)+"</span>\n                    </div>\n                    <div class='move'>\n                      <span class='name'>"+s+"</span><span class='type "+moves[a.move_2].type.toLowerCase()+"'>"+i8ln(moves[a.move_2].type)+"</span>\n                    </div>"}var r=getDateStr(e.last_scanned),l=getDateStr(e.last_modified),c=e.slots_available?1===e.slots_available?"1 Free Slot":e.slots_available+" Free Slots":"No Free Slots",p=["85,85,85,1","0,134,255,1","255,26,26,1","255,159,25,1"],d=gymTypes[e.team_id],m=null!=a&&Date.now()<a.start,g=isOngoingRaid(a),u=Store.get("showRaids"),k="",h="",v="",y="",f="",w=e.total_cp,S=e.name?e.name:0===e.team_id?d:"Team "+d,M="\n      <div class='gym name' style='color:rgba("+p[e.team_id]+")'>\n        "+S+"\n      </div>";if(0!==e.team_id&&(k="\n        <div>\n            <img class='gym info strength' src='static/images/gym/Strength.png'>\n            <span class='gym info strength'>\n              Strength: "+w+" ("+c+")\n            </span>\n        </div>"),(m||g)&&u&&isGymSatisfiesRaidMinMaxFilter(a)){var _=["252,112,176","255,158,22","184,165,221"],L="★".repeat(a.level);g?(h="\n                <img class='gym sprite' src='static/images/raid/"+gymTypes[e.team_id]+"_"+a.level+"_unknown.png'>\n                <div class='raid'>\n                <span style='color:rgb("+_[Math.floor((a.level-1)/2)]+")'>\n                "+L+"\n                </span>\n                <span class='raid countdown label-countdown' disappears-at='"+a.end+"'></span> left\n                </div>\n            ",null!==a.pokemon_id&&-1!==n.indexOf(a.pokemon_id)&&(h="\n                    <div class='raid container'>\n                    <div class='raid container content-left'>\n                        <div>\n                        <img class='gym sprite' src='static/icons/"+a.pokemon_id+".png'>\n                        </div>\n                    </div>\n                    <div class='raid container content-right'>\n                        <div>\n                        <div class='raid pokemon'>\n                            "+a.pokemon_name+" <a href='http://pokemon.gameinfo.io/en/pokemon/"+a.pokemon_id+"' target='_blank' title='View in Pokédex'>#"+a.pokemon_id+"</a> | CP: "+a.cp+"\n                    </div>\n                        "+o+"\n                    </div>\n                    </div>\n                </div>\n                    <div class='raid'>\n                    <span style='color:rgb("+_[Math.floor((a.level-1)/2)]+")'>\n                    "+L+"\n                    </span>\n                    <span class='raid countdown label-countdown' disappears-at='"+a.end+"'></span> left\n                    </div>\n                ")):h="<img class='gym sprite' src='static/images/gym/"+gymTypes[e.team_id]+"_"+getGymLevel(e)+"_"+a.level+".png'>",m&&(v="\n                <div class='raid'>\n                  <span style='color:rgb("+_[Math.floor((a.level-1)/2)]+")'>\n                  "+L+"\n                  </span>\n                  Raid in <span class='raid countdown label-countdown' disappears-at='"+a.start+"'></span>\n                </div>")}else h="<img class='gym sprite' src='static/images/gym/"+d+"_"+getGymLevel(e)+".png'>";return y="\n            <div class='gym container'>\n                <div>\n                  <span class='gym info navigate'>\n                    <a href='javascript:void(0);' onclick='javascript:openMapDirections("+e.latitude+","+e.longitude+");' title='Open in Google Maps'>\n                      "+e.latitude.toFixed(6)+", "+e.longitude.toFixed(7)+"\n                    </a>\n                  </span>\n                </div>\n                <div class='gym info last-scanned'>\n                    Last Scanned: "+r+"\n                </div>\n                <div class='gym info last-modified'>\n                    Last Modified: "+l+"\n                </div>\n            </div>\n        </div>",t&&(f="<div>",e.pokemon.forEach(function(e){f+="\n            <span class='gym member'>\n              <center>\n                <div>\n                  <div>\n                    <i class='pokemon-sprite n"+e.pokemon_id+"'></i>\n                  </div>\n                  <div>\n                    <span class='gym pokemon'>"+e.pokemon_name+"</span>\n                  </div>\n                  <div>\n                    <img class='gym pokemon motivation heart' src='static/images/gym/Heart.png'> <span class='gym pokemon motivation'>"+e.cp_decayed+"</span>\n                  </div>\n                </div>\n              </center>\n            </span>"}),f+="</div>"),"\n        <div>\n            <center>\n                "+M+"\n                "+k+"\n                "+h+"\n                "+v+"\n            </center>\n            "+y+"\n            <center>\n                "+f+"\n            </center>\n        </div>"}function pokestopLabel(e,t,n){var a;return a=e?"\n            <div>\n              <div class='pokestop lure'>\n                Lured Pokéstop\n              </div>\n              <div class='pokestop-expire'>\n                  <span class='label-countdown' disappears-at='"+e+"'>00m00s</span> left\n              </div>\n              <div>\n                <img class='pokestop sprite' src='static/images/pokestop//PokestopLured.png'>\n              </div>\n              <div>\n                <span class='pokestop navigate'><a href='javascript:void(0);' onclick='javascript:openMapDirections("+t+","+n+");' title='Open in Google Maps'; class='pokestop lure'>"+t.toFixed(6)+", "+n.toFixed(7)+"</a></span>\n              </div>\n            </div>\n          </div>":"\n            <div>\n              <div class='pokestop nolure'>\n                Pokéstop\n              </div>\n              <div>\n                <img class='pokestop sprite' src='static/images/pokestop//Pokestop.png'>\n              </div>\n              <div>\n                <span class='pokestop navigate'><a href='javascript:void(0);' onclick='javascript:openMapDirections("+t+","+n+");' title='Open in Google Maps'; class='pokestop nolure'>"+t.toFixed(6)+", "+n.toFixed(7)+"</a></span>\n              </div>\n            </div>\n          </div>"}function formatSpawnTime(e){return("0"+Math.floor((e+3600)%3600/60)).substr(-2)+":"+("0"+e%60).substr(-2)}function spawnpointLabel(e){var t="\n        <div>\n            <b>Spawn Point</b>\n        </div>";return e.uncertain?t+="\n            <div>\n                Spawn times not yet determined. Current guess "+formatSpawnTime(e.appear_time)+" until "+formatSpawnTime(e.disappear_time)+"\n            </div>":t+="\n            <div>\n                Every hour from "+formatSpawnTime(e.appear_time)+" to "+formatSpawnTime(e.disappear_time)+"\n            </div>",t}function addRangeCircle(e,t,n,a){var o=null,i=new google.maps.LatLng(e.position.lat(),e.position.lng()),s=["#999999","#0051CF","#FF260E","#FECC23"],r=s[0];a&&(r=s[a]);var l,c;switch(n){case"pokemon":c="#C233F2",l=40;break;case"pokestop":c="#3EB0FF",l=40;break;case"gym":c=r,l=40}t&&(o=t);var p={map:o,radius:l,strokeWeight:1,strokeColor:c,strokeOpacity:.9,center:i,fillColor:c,fillOpacity:.3};return new google.maps.Circle(p)}function isRangeActive(e){return!(e.getZoom()<16)&&Store.get("showRanges")}function getIv(e,t,n){return null!==e&&100*(e+t+n)/45}function getPokemonLevel(e){if(e<.734)var t=58.35178527*e*e-2.838007664*e+.8539209906;else t=171.0112688*e-95.20425243;return t=2*Math.round(t)/2}function getGymLevel(e){return 6-e.slots_available}function getRaidLevel(e){return null===e?0:e.level}function lpad(e,t,n){return Array(Math.max(t-String(e).length+1,0)).join(n)+e}function repArray(e,t,n){for(var a=0;a<t.length;a++)e=e.replace(t[a],n[a]);return e}function getTimeUntil(e){var t=Date.now(),n=e-t,a=Math.floor(n/1e3%60),o=Math.floor(n/1e3/60%60);return{total:n,hour:Math.floor(n/36e5%24),min:o,sec:a,now:t,ttime:e}}function getNotifyText(e){var t=getIv(e.individual_attack,e.individual_defense,e.individual_stamina),n=["<prc>","<pkm>","<atk>","<def>","<sta>"],a=[t?t.toFixed(1):"",e.pokemon_name,e.individual_attack,e.individual_defense,e.individual_stamina],o=repArray(t?notifyIvTitle:notifyNoIvTitle,n,a),i=moment(e.disappear_time).format("HH:mm:ss"),s=getTimeUntil(e.disappear_time),r=s.hour>0?s.hour+":":"";return r+=lpad(s.min,2,0)+"m"+lpad(s.sec,2,0)+"s",{fav_title:o,fav_text:repArray(notifyText,n=["<dist>","<udist>"],a=[i,r])}}function playPokemonSound(e,t){if(Store.get("playSound"))if(Store.get("playCries")){if(0===t.length)return;var n=t.shift();new Audio("static/sounds/cries/"+e+"."+n).play().catch(function(a){a&&(console.log("Sound filetype %s for Pokémon %s is missing.",n,e),playPokemonSound(e,t))})}else audio.play()}function isNotifyPoke(e){var t=notifiedPokemon.indexOf(e.pokemon_id)>-1||notifiedRarity.indexOf(e.pokemon_rarity)>-1,n=!1;if(null!=e.individual_attack){var a=getIv(e.individual_attack,e.individual_defense,e.individual_stamina);n=notifiedMinPerfection>0&&a>=notifiedMinPerfection}return t||n}function customizePokemonMarker(e,t,n){var a=getNotifyText(t);e.addListener("click",function(){this.setAnimation(null),this.animationDisabled=!0}),!e.rangeCircle&&isRangeActive(map)&&(e.rangeCircle=addRangeCircle(e,map,"pokemon")),e.infoWindow=new google.maps.InfoWindow({content:pokemonLabel(t),disableAutoPan:!0}),isNotifyPoke(t)&&(n||(playPokemonSound(t.pokemon_id,cryFileTypes),sendNotification(a.fav_title,a.fav_text,"static/icons/"+t.pokemon_id+".png",t.latitude,t.longitude)),!0!==e.animationDisabled&&e.setAnimation(google.maps.Animation.BOUNCE)),addListeners(e)}function setupGymMarker(e){var t=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:map});return t.infoWindow=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),updateGymMarker(e,t),!t.rangeCircle&&isRangeActive(map)&&(t.rangeCircle=addRangeCircle(t,map,"gym",e.team_id)),Store.get("useGymSidebar")?(t.addListener("click",function(){var t=document.querySelector("#gym-details");t.getAttribute("data-id")===e.gym_id&&t.classList.contains("visible")?t.classList.remove("visible"):(t.setAttribute("data-id",e.gym_id),showGymDetails(e.gym_id))}),google.maps.event.addListener(t.infoWindow,"closeclick",function(){t.persist=null}),isMobileDevice()||isTouchDevice()||t.addListener("mouseover",function(){t.infoWindow.open(map,t),clearSelection(),updateLabelDiffTime()}),t.addListener("mouseout",function(){t.persist||t.infoWindow.close()})):addListeners(t),t}function updateGymMarker(e,t){var n=getRaidLevel(e.raid),a=[3,6,9,59,65,68,89,94,103,110,112,125,126,129,131,134,135,136,143,144,145,146,153,156,159,248,249];if(null!==e.raid&&isOngoingRaid(e.raid)&&Store.get("showRaids")&&n>=Store.get("showRaidMinLevel")&&n<=Store.get("showRaidMaxLevel")){var o="static/images/raid/"+gymTypes[e.team_id]+"_"+e.raid.level+"_unknown.png";-1!==a.indexOf(e.raid.pokemon_id)&&(o="static/images/raid/"+gymTypes[e.team_id]+"_"+e.raid.pokemon_id+".png"),t.setIcon({url:o,scaledSize:new google.maps.Size(48,48)}),t.setZIndex(google.maps.Marker.MAX_ZINDEX+1)}else null!==e.raid&&e.raid.end>Date.now()&&Store.get("showRaids")&&!Store.get("showActiveRaidsOnly")&&n>=Store.get("showRaidMinLevel")&&n<=Store.get("showRaidMaxLevel")?t.setIcon({url:"static/images/gym/"+gymTypes[e.team_id]+"_"+getGymLevel(e)+"_"+e.raid.level+".png",scaledSize:new google.maps.Size(48,48)}):(t.setIcon({url:"static/images/gym/"+gymTypes[e.team_id]+"_"+getGymLevel(e)+".png",scaledSize:new google.maps.Size(48,48)}),t.setZIndex(1));return t.infoWindow.setContent(gymLabel(e)),t}function setupPokestopMarker(e){var t={url:"static/images/pokestop/"+(e.lure_expiration?"PokestopLured":"Pokestop")+".png",scaledSize:new google.maps.Size(32,32)},n=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:map,zIndex:e.lure_expiration?3:2,icon:t});return!n.rangeCircle&&isRangeActive(map)&&(n.rangeCircle=addRangeCircle(n,map,"pokestop")),n.infoWindow=new google.maps.InfoWindow({content:pokestopLabel(e.lure_expiration,e.latitude,e.longitude),disableAutoPan:!0}),addListeners(n),n}function getColorByDate(e){var t=(Date.now()-e)/1e3/60/15;return t>1&&(t=1),["hsl(",(120*(1-t)).toString(10),",100%,50%)"].join("")}function setupScannedMarker(e){var t=new google.maps.LatLng(e.latitude,e.longitude);return new google.maps.Circle({map:map,clickable:!1,center:t,radius:!0===showConfig.pokemons?70:450,fillColor:getColorByDate(e.last_modified),fillOpacity:.1,strokeWeight:1,strokeOpacity:.5})}function getColorBySpawnTime(e){var t=new Date,n=60*t.getMinutes()+t.getSeconds();n<900&&e>2700?n+=3600:n>2700&&e<900&&(e+=3600);var a=n-e,o=275;return a>=0&&a<=1800?o=120*(1-a/60/30):a<0&&a>-300&&(o=50*(1- -a/60/5)+200),o=5*Math.round(o/5)}function changeSpawnIcon(e,t){var n="";n=275===e?"./static/icons/hsl-275-light.png":"./static/icons/hsl-"+e+".png";var a=1.6,o=1,i=Math.round(1.6*(t-10));return i<1&&(i=1),{url:n,scaledSize:new google.maps.Size(i,i),anchor:new google.maps.Point(i/2,i/2)}}function spawnPointIndex(e){var t=1,n=0;return e>=0&&e<=120?t=100+100*(n=e/120):e>=200&&e<=250&&(t=100*(n=(e-200)/50)),t}function setupSpawnpointMarker(e){var t=new google.maps.LatLng(e.latitude,e.longitude),n=getColorBySpawnTime(e.appear_time),a=map.getZoom(),o=new google.maps.Marker({map:map,position:t,icon:changeSpawnIcon(n,a),zIndex:spawnPointIndex(n)});return o.infoWindow=new google.maps.InfoWindow({content:spawnpointLabel(e),disableAutoPan:!0,position:t}),addListeners(o),o}function clearSelection(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}function addListeners(e){return e.addListener("click",function(){e.infoWindowIsOpen?(e.persist=null,e.infoWindow.close(),e.infoWindowIsOpen=!1):(e.infoWindow.open(map,e),clearSelection(),updateLabelDiffTime(),e.persist=!0,e.infoWindowIsOpen=!0)}),google.maps.event.addListener(e.infoWindow,"closeclick",function(){e.persist=null}),isMobileDevice()||isTouchDevice()||e.addListener("mouseover",function(){e.infoWindow.open(map,e),clearSelection(),updateLabelDiffTime()}),e.addListener("mouseout",function(){e.persist||e.infoWindow.close()}),e}function clearStaleMarkers(){var e=[];$.each(mapData.pokemons,function(t,n){var a=mapData.pokemons[t].disappear_time<Date.now(),o=-1!==excludedPokemon.indexOf(mapData.pokemons[t].pokemon_id);if(a||o){var i=mapData.pokemons[t].marker;i.rangeCircle&&(i.rangeCircle.setMap(null),delete i.rangeCircle),e.push(i),i.setMap(null),delete mapData.pokemons[t],i.setMap=function(){}}}),markerCluster.removeMarkers(e,!0),$.each(mapData.lurePokemons,function(e,t){(mapData.lurePokemons[e].lure_expiration<(new Date).getTime()||excludedPokemon.indexOf(mapData.lurePokemons[e].pokemon_id)>=0)&&(mapData.lurePokemons[e].marker.setMap(null),delete mapData.lurePokemons[e])}),$.each(mapData.scanned,function(e,t){mapData.scanned[e].last_modified<(new Date).getTime()-9e5&&(mapData.scanned[e].marker.setMap(null),delete mapData.scanned[e])})}function showInBoundsMarkers(e,t){$.each(e,function(n,a){var o=e[n],i=o.marker,s=!1;o.hidden||("function"==typeof i.getBounds?map.getBounds().intersects(i.getBounds())&&(s=!0):"function"==typeof i.getPosition&&map.getBounds().contains(i.getPosition())&&(s=!0)),s&&-1!==rangeMarkers.indexOf(t)&&(i.rangeCircle?isRangeActive(map)?i.rangeCircle.setMap(map):i.rangeCircle.setMap(null):isRangeActive(map)&&(i.rangeCircle="gym"===t?addRangeCircle(i,map,t,o.team_id):addRangeCircle(i,map,t))),s&&!i.getMap()?(i.setMap(map),i.setAnimation&&i.oldAnimation&&i.setAnimation(i.oldAnimation)):!s&&i.getMap()&&(i.getAnimation&&(i.oldAnimation=i.getAnimation()),i.rangeCircle&&i.rangeCircle.setMap(null),i.setMap(null))})}function loadRawData(){var e=Store.get("showPokemon"),t=Store.get("showGyms")||Store.get("showRaids"),n=Store.get("showPokestops"),a=Store.get("showScanned"),o=Store.get("showSpawnpoints"),i=Boolean(Store.get("showLuredPokestopsOnly")),s=map.getBounds(),r=s.getSouthWest(),l=s.getNorthEast(),c=r.lat(),p=r.lng(),d=l.lat(),m=l.lng();return $.ajax({url:"raw_data",type:"GET",data:{timestamp:timestamp,pokemon:e,lastpokemon:lastpokemon,pokestops:n,lastpokestops:lastpokestops,luredonly:i,gyms:t,lastgyms:lastgyms,scanned:a,lastslocs:lastslocs,spawnpoints:o,lastspawns:lastspawns,swLat:c,swLng:p,neLat:d,neLng:m,oSwLat:oSwLat,oSwLng:oSwLng,oNeLat:oNeLat,oNeLng:oNeLng,reids:String(reincludedPokemon),eids:String(excludedPokemon)},dataType:"json",cache:!1,beforeSend:function e(){if(rawDataIsLoading)return!1;rawDataIsLoading=!0},error:function e(){toastr.error("Please check connectivity or reduce marker settings.","Error getting data"),toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"25000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"}},complete:function e(){rawDataIsLoading=!1}})}function processPokemons(e){if(!Store.get("showPokemon"))return!1;processPokemonChunked(e,Store.get("processPokemonChunkSize"))}function processPokemonChunked(e,t){if(void 0!==e&&0!==e.length){var n=[],a=[],o=e.splice(-1*t);$.each(o,function(e,t){var o=t.encounter_id,i=t.disappear_time<Date.now()+3e3;if(!mapData.pokemons.hasOwnProperty(o)&&!i){var s=processPokemon(t),r=s[0],l=s[1];isNotifyPoke(t)?(r&&r.setMap(map),l&&l.setMap(null)):(r&&a.push(r),l&&n.push(l))}}),markerCluster.removeMarkers(n,!0),markerCluster.addMarkers(a,!1),e.length>0&&setTimeout(function(){processPokemonChunked(e,t)},Store.get("processPokemonIntervalMs"))}}function processPokemon(e){var t=-1!==excludedPokemon.indexOf(e.pokemon_id),n=e.disappear_time>Date.now(),a=null,o=null;return e.encounter_id in mapData.pokemons||t||!n||(e.hidden?a=e.marker:(e.marker?updatePokemonMarker(e.marker,map):(customizePokemonMarker(o=setupPokemonMarker(e,map),e),e.marker=o),mapData.pokemons[e.encounter_id]=e)),[o,a]}function processPokestop(e,t){if(!Store.get("showPokestops"))return!1;if(Store.get("showLuredPokestopsOnly")&&!t.lure_expiration)return!0;if(mapData.pokestops[t.pokestop_id]){var n=mapData.pokestops[t.pokestop_id];!!t.lure_expiration!=!!n.lure_expiration&&(n.marker&&n.marker.rangeCircle&&n.marker.rangeCircle.setMap(null),n.marker.setMap(null),t.marker=setupPokestopMarker(t),mapData.pokestops[t.pokestop_id]=t)}else t.marker&&t.marker.rangeCircle&&t.marker.rangeCircle.setMap(null),t.marker&&t.marker.setMap(null),t.marker=setupPokestopMarker(t),mapData.pokestops[t.pokestop_id]=t}function updatePokestops(){if(!Store.get("showPokestops"))return!1;var e=[],t=(new Date).getTime();$.each(mapData.pokestops,function(e,n){n.lure_expiration&&n.lure_expiration<t&&(n.lure_expiration=null,n.marker&&n.marker.rangeCircle&&n.marker.rangeCircle.setMap(null),n.marker.setMap(null),n.marker=setupPokestopMarker(n))}),Store.get("showLuredPokestopsOnly")&&($.each(mapData.pokestops,function(t,n){n.lure_expiration||e.push(t)}),$.each(e,function(e,t){mapData.pokestops[t]&&mapData.pokestops[t].marker&&(mapData.pokestops[t].marker.rangeCircle&&mapData.pokestops[t].marker.rangeCircle.setMap(null),mapData.pokestops[t].marker.setMap(null),delete mapData.pokestops[t])}))}function processGym(e,t){var n=getGymLevel(t),a=getRaidLevel(t.raid);if(!Store.get("showGyms")&&!Store.get("showRaids"))return!1;var o=function e(t){mapData.gyms[t]&&mapData.gyms[t].marker&&(mapData.gyms[t].marker.rangeCircle&&mapData.gyms[t].marker.rangeCircle.setMap(null),mapData.gyms[t].marker.setMap(null),delete mapData.gyms[t])};if(Store.get("showOpenGymsOnly")&&0===t.slots_available)return o(t.gym_id),!0;if(!Store.get("showGyms")){if(Store.get("showRaids")&&!isValidRaid(t.raid))return o(t.gym_id),!0;if(Store.get("showActiveRaidsOnly")&&!isOngoingRaid(t.raid))return o(t.gym_id),!0;if(a>Store.get("showRaidMaxLevel")||a<Store.get("showRaidMinLevel"))return o(t.gym_id),!0}if(Store.get("showTeamGymsOnly")&&Store.get("showTeamGymsOnly")!==t.team_id)return o(t.gym_id),!0;if(Store.get("showLastUpdatedGymsOnly")){var i=new Date;if(3600*Store.get("showLastUpdatedGymsOnly")*1e3+t.last_scanned<i.getTime())return o(t.gym_id),!0}return n<Store.get("minGymLevel")?(o(t.gym_id),!0):n>Store.get("maxGymLevel")?(o(t.gym_id),!0):(t.gym_id in mapData.gyms?t.marker=updateGymMarker(t,mapData.gyms[t.gym_id].marker):t.marker=setupGymMarker(t),void(mapData.gyms[t.gym_id]=t))}function processScanned(e,t){if(!Store.get("showScanned"))return!1;var n=t.latitude+"|"+t.longitude;n in mapData.scanned?mapData.scanned[n].last_modified=t.last_modified:(t.marker&&t.marker.setMap(null),t.marker=setupScannedMarker(t),mapData.scanned[n]=t)}function updateScanned(){if(!Store.get("showScanned"))return!1;$.each(mapData.scanned,function(e,t){map.getBounds().intersects(t.marker.getBounds())&&t.marker.setOptions({fillColor:getColorByDate(t.last_modified)})})}function processSpawnpoint(e,t){if(!Store.get("showSpawnpoints"))return!1;var n=t.id;n in mapData.spawnpoints||(t.marker&&t.marker.setMap(null),t.marker=setupSpawnpointMarker(t),mapData.spawnpoints[n]=t)}function updateSpawnPoints(){if(!Store.get("showSpawnpoints"))return!1;var e=map.getZoom();$.each(mapData.spawnpoints,function(t,n){if(map.getBounds().contains(n.marker.getPosition())){var a=getColorBySpawnTime(n.appear_time);n.marker.setIcon(changeSpawnIcon(a,e)),n.marker.setZIndex(spawnPointIndex(a))}})}function updateMap(){loadRawData().done(function(e){processPokemons(e.pokemons),$.each(e.pokestops,processPokestop),$.each(e.gyms,processGym),$.each(e.scanned,processScanned),$.each(e.spawnpoints,processSpawnpoint),showInBoundsMarkers(mapData.lurePokemons,"pokemon"),showInBoundsMarkers(mapData.gyms,"gym"),showInBoundsMarkers(mapData.pokestops,"pokestop"),showInBoundsMarkers(mapData.scanned,"scanned"),showInBoundsMarkers(mapData.spawnpoints,"inbound"),clearStaleMarkers(),markerCluster.repaint(),updateScanned(),updateSpawnPoints(),updatePokestops(),$("#stats").hasClass("visible")&&countMarkers(map),oSwLat=e.oSwLat,oSwLng=e.oSwLng,oNeLat=e.oNeLat,oNeLng=e.oNeLng,lastgyms=e.lastgyms,lastpokestops=e.lastpokestops,lastpokemon=e.lastpokemon,lastslocs=e.lastslocs,lastspawns=e.lastspawns,(reids=e.reids)instanceof Array&&(reincludedPokemon=reids.filter(function(e){return this.indexOf(e)<0},reincludedPokemon)),timestamp=e.timestamp,lastUpdateTime=Date.now()})}function redrawPokemon(e){$.each(e,function(t,n){var a=e[t];a.hidden||updatePokemonMarker(a,map)})}function getPointDistance(e,t){return google.maps.geometry.spherical.computeDistanceBetween(e,t)}function sendNotification(e,t,n,a,o){if(!("Notification"in window))return!1;if("granted"!==Notification.permission)Notification.requestPermission();else{var i=new Notification(e,{icon:n,body:t,sound:"sounds/ding.mp3"});i.onclick=function(){window.focus(),i.close(),centerMap(a,o,20)}}}function createMyLocationButton(){var e=document.createElement("div"),t=document.createElement("button");t.style.backgroundColor="#fff",t.style.border="none",t.style.outline="none",t.style.width="28px",t.style.height="28px",t.style.borderRadius="2px",t.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",t.style.cursor="pointer",t.style.marginRight="10px",t.style.padding="0px",t.title="My Location",e.appendChild(t);var n=document.createElement("div");n.style.margin="5px",n.style.width="18px",n.style.height="18px",n.style.backgroundImage="url(static/mylocation-sprite-1x.png)",n.style.backgroundSize="180px 18px",n.style.backgroundPosition="0px 0px",n.style.backgroundRepeat="no-repeat",n.id="current-location",t.appendChild(n),t.addEventListener("click",function(){centerMapOnLocation()}),e.index=1,map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e),google.maps.event.addListener(map,"dragend",function(){document.getElementById("current-location").style.backgroundPosition="0px 0px"})}function centerMapOnLocation(){var e=document.getElementById("current-location"),t="0",n=setInterval(function(){t="-18"===t?"0":"-18",e.style.backgroundPosition=t+"px 0"},500);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var a=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);locationMarker.setPosition(a),map.setCenter(a),Store.set("followMyLocationPosition",{lat:t.coords.latitude,lng:t.coords.longitude}),clearInterval(n),e.style.backgroundPosition="-144px 0px"}):(clearInterval(n),e.style.backgroundPosition="0px 0px")}function changeLocation(e,t){var n=new google.maps.LatLng(e,t);changeSearchLocation(e,t).done(function(){map.setCenter(n),searchMarker.setPosition(n)})}function changeSearchLocation(e,t){return $.post("next_loc?lat="+e+"&lon="+t,{})}function centerMap(e,t,n){var a=new google.maps.LatLng(e,t);map.setCenter(a),n&&(storeZoom=!1,map.setZoom(n))}function i8ln(e){return $.isEmptyObject(i8lnDictionary)&&"en"!==language&&languageLookups<languageLookupThreshold&&$.ajax({url:"static/dist/locales/"+language+".min.json",dataType:"json",async:!1,success:function e(t){i8lnDictionary=t},error:function e(t,n,a){console.log("Error loading i8ln dictionary: "+a),languageLookups++}}),e in i8lnDictionary?i8lnDictionary[e]:e}function updateGeoLocation(){navigator.geolocation&&(Store.get("geoLocate")||Store.get("followMyLocation"))&&navigator.geolocation.getCurrentPosition(function(e){var t=e.coords.latitude,n=e.coords.longitude,a=new google.maps.LatLng(t,n);Store.get("geoLocate")&&void 0!==searchMarker&&getPointDistance(searchMarker.getPosition(),a)>40&&$.post("next_loc?lat="+t+"&lon="+n).done(function(){map.panTo(a),searchMarker.setPosition(a)}),Store.get("followMyLocation")&&void 0!==locationMarker&&getPointDistance(locationMarker.getPosition(),a)>=5&&(map.panTo(a),locationMarker.setPosition(a),Store.set("followMyLocationPosition",{lat:t,lng:n}))})}function createUpdateWorker(){try{if(isMobileDevice()&&window.Worker){var e=new Blob(["onmessage = function(e) {\n                var data = e.data\n                if (data.name === 'backgroundUpdate') {\n                    self.setInterval(function () {self.postMessage({name: 'backgroundUpdate'})}, 5000)\n                }\n            }"]),t=window.URL.createObjectURL(e);(updateWorker=new Worker(t)).onmessage=function(e){var t=e.data;document.hidden&&"backgroundUpdate"===t.name&&Date.now()-lastUpdateTime>2500&&(updateMap(),updateGeoLocation())},updateWorker.postMessage({name:"backgroundUpdate"})}}catch(e){console.log("Webworker error: "+e.message)}}function showGymDetails(e){var t=document.querySelector("#gym-details"),n;t.classList.add("visible"),$.ajax({url:"gym_data",type:"GET",data:{id:e},dataType:"json",cache:!1}).done(function(e){var a="";e.pokemon.length?(e.pokemon.forEach(function(e){a+=getSidebarGymMember(e)}),a="<table><tbody>"+a+"</tbody></table>"):a=0===e.team_id?"":'\n                <center>\n                    Gym Leader:<br>\n                    <i class="pokemon-large-sprite n'+e.guard_pokemon_id+'"></i><br>\n                    <b>'+e.guard_pokemon_name+'</b>\n\n                    <p style="font-size: .75em; margin: 5px;">\n                        No additional gym information is available for this gym. Make sure you are collecting <a href="https://rocketmap.readthedocs.io/en/develop/extras/gyminfo.html">detailed gym info.</a>\n                        If you have detailed gym info collection running, this gym\'s Pokemon information may be out of date.\n                    </p>\n                </center>\n            ';var o=gymLabel(e,!1);t.innerHTML=""+o+a,(n=document.createElement("a")).href="#",n.className="close",n.tabIndex=0,t.appendChild(n),n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),t.classList.remove("visible")})})}function getSidebarGymMember(e){var t=getIv(e.iv_attack,e.iv_defense,e.iv_stamina),n=Math.round(100/e.move_2_energy);return'\n                    <tr onclick=toggleGymPokemonDetails(this)>\n                        <td width="30px">\n                            <img class="gym pokemon sprite" src="static/icons/'+e.pokemon_id+'.png">\n                        </td>\n                        <td>\n                            <div class="gym pokemon" style="line-height:0.5em;">'+e.pokemon_name+'</div>\n                            <div><img class="gym pokemon motivation heart" src="static/images/gym/Heart.png"> <span class="gym pokemon motivation">'+e.cp_decayed+'</span></div>\n                        </td>\n                        <td width="190" align="center">\n                            <div class="gym pokemon" style="line-height:1em;">'+e.trainer_name+" ("+e.trainer_level+')</div>\n                            <div class="gym pokemon">Deployed '+getDateStr(e.deployment_time)+'</div>\n                        </td>\n                        <td width="10">\n                            \x3c!--<a href="#" onclick="toggleGymPokemonDetails(this)">--\x3e\n                                <i class="fa fa-angle-double-down"></i>\n                            \x3c!--</a>--\x3e\n                        </td>\n                    </tr>\n                    <tr class="details">\n                        <td colspan="2">\n                            <div class="ivs">\n                                <div class="iv">\n                                    <div class="type">ATK</div>\n                                    <div class="value">\n                                        '+e.iv_attack+'\n                                    </div>\n                                </div>\n                                <div class="iv">\n                                    <div class="type">DEF</div>\n                                    <div class="value">\n                                        '+e.iv_defense+'\n                                    </div>\n                                </div>\n                                <div class="iv">\n                                    <div class="type">STA</div>\n                                    <div class="value">\n                                        '+e.iv_stamina+'\n                                    </div>\n                                </div>\n                                <div class="iv" style="width: 36px;"">\n                                    <div class="type">PERFECT</div>\n                                    <div class="value">\n                                        '+t.toFixed(0)+'<span style="font-size: .6em;">%</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                        <td colspan="2">\n                            <div class="moves">\n                                <div class="move">\n                                    <div class="name">\n                                        '+e.move_1_name+'\n                                        <div class="type '+e.move_1_type.type_en.toLowerCase()+'">'+e.move_1_type.type+'</div>\n                                    </div>\n                                    <div class="damage">\n                                        '+e.move_1_damage+'\n                                    </div>\n                                </div>\n                                <br>\n                                <div class="move">\n                                    <div class="name">\n                                        '+e.move_2_name+'\n                                        <div class="type '+e.move_2_type.type_en.toLowerCase()+'">'+e.move_2_type.type+'</div>\n                                        <div>\n                                            <i class="move-bar-sprite move-bar-sprite-'+n+'"></i>\n                                        </div>\n                                    </div>\n                                    <div class="damage">\n                                        '+e.move_2_damage+"\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                    </tr>\n                    "}function toggleGymPokemonDetails(e){e.lastElementChild.firstElementChild.classList.toggle("fa-angle-double-up"),e.lastElementChild.firstElementChild.classList.toggle("fa-angle-double-down"),e.nextElementSibling.classList.toggle("visible")}function getParameterByName(e,t){t||(t=window.location.search),e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var $selectExclude,$selectPokemonNotify,$selectRarityNotify,$textPerfectionNotify,$selectStyle,$selectIconSize,$switchOpenGymsOnly,$switchActiveRaidGymsOnly,$switchRaidMinLevel,$switchRaidMaxLevel,$selectTeamGymsOnly,$selectLastUpdateGymsOnly,$selectMinGymLevel,$selectMaxGymLevel,$selectLuredPokestopsOnly,$selectSearchIconMarker,$selectLocationIconMarker,$switchGymSidebar,language=""===document.documentElement.lang?"en":document.documentElement.lang,idToPokemon={},i8lnDictionary={},languageLookups=0,languageLookupThreshold=3,searchMarkerStyles,timestamp,excludedPokemon=[],notifiedPokemon=[],notifiedRarity=[],notifiedMinPerfection=null,buffer=[],reincludedPokemon=[],reids=[],map,markerCluster,rawDataIsLoading=!1,locationMarker,rangeMarkers=["pokemon","pokestop","gym"],searchMarker,storeZoom=!0,moves,oSwLat,oSwLng,oNeLat,oNeLng,lastpokestops,lastgyms,lastpokemon,lastslocs,lastspawns,selectedStyle="light",updateWorker,lastUpdateTime,redrawTimeout=null,gymTypes=["Uncontested","Mystic","Valor","Instinct"],audio=new Audio("static/sounds/ding.mp3"),cryFileTypes=["wav","mp3"],genderType=["♂","♀","⚲"],unownForm=["unset","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","!","?"],notifyIvTitle="<pkm> <prc>% (<atk>/<def>/<sta>)",notifyNoIvTitle="<pkm>",notifyText="disappears at <dist> (<udist>)",searchControlURI="search_control",updateLabelDiffTime=function e(){$(".label-countdown").each(function(e,t){var n=getTimeUntil(parseInt(t.getAttribute("disappears-at"))),a=n.hour,o=n.min,i=n.sec,s="";n.ttime<n.now?s="(expired)":(s="",a>0&&(s=a+"hour "),s+=lpad(o,2,0)+"min ",s+=lpad(i,2,0)+"sec ",s+=""),$(t).text(s)})};$(function(){Notification?"granted"!==Notification.permission&&Notification.requestPermission():console.log("could not load notifications")}),$(function(){$selectStyle=$("#map-style"),$.getJSON("static/dist/data/mapstyle.min.json").done(function(e){var t=[];$.each(e,function(e,n){t.push({id:e,text:i8ln(n)})}),$selectStyle.select2({placeholder:"Select Style",data:t,minimumResultsForSearch:1/0}),$selectStyle.on("change",function(e){selectedStyle=$selectStyle.val(),map.setMapTypeId(selectedStyle),Store.set("map_style",selectedStyle)}),$selectStyle.val(Store.get("map_style")).trigger("change")}),($selectIconSize=$("#pokemon-icon-size")).select2({placeholder:"Select Icon Size",minimumResultsForSearch:1/0}),$selectIconSize.on("change",function(){Store.set("iconSizeModifier",this.value),redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons),markerCluster.resetViewport(),markerCluster.redraw()}),($switchOpenGymsOnly=$("#open-gyms-only-switch")).on("change",function(){Store.set("showOpenGymsOnly",this.checked),lastgyms=!1,updateMap()}),($switchActiveRaidGymsOnly=$("#raid-active-gym-switch")).on("change",function(){Store.set("showActiveRaidsOnly",this.checked),lastgyms=!1,updateMap()}),($switchRaidMinLevel=$("#raid-min-level-only-switch")).select2({placeholder:"Minimum raid level",minimumResultsForSearch:1/0}),$switchRaidMinLevel.on("change",function(){Store.set("showRaidMinLevel",this.value),lastgyms=!1,updateMap()}),($switchRaidMaxLevel=$("#raid-max-level-only-switch")).select2({placeholder:"Maximum raid level",minimumResultsForSearch:1/0}),$switchRaidMaxLevel.on("change",function(){Store.set("showRaidMaxLevel",this.value),lastgyms=!1,updateMap()}),($selectTeamGymsOnly=$("#team-gyms-only-switch")).select2({placeholder:"Only Show Gyms For Team",minimumResultsForSearch:1/0}),$selectTeamGymsOnly.on("change",function(){Store.set("showTeamGymsOnly",this.value),lastgyms=!1,updateMap()}),($selectLastUpdateGymsOnly=$("#last-update-gyms-switch")).select2({placeholder:"Only Show Gyms Last Updated",minimumResultsForSearch:1/0}),$selectLastUpdateGymsOnly.on("change",function(){Store.set("showLastUpdatedGymsOnly",this.value),lastgyms=!1,updateMap()}),($selectMinGymLevel=$("#min-level-gyms-filter-switch")).select2({placeholder:"Minimum Gym Level",minimumResultsForSearch:1/0}),$selectMinGymLevel.on("change",function(){Store.set("minGymLevel",this.value),lastgyms=!1,updateMap()}),($selectMaxGymLevel=$("#max-level-gyms-filter-switch")).select2({placeholder:"Maximum Gym Level",minimumResultsForSearch:1/0}),$selectMaxGymLevel.on("change",function(){Store.set("maxGymLevel",this.value),lastgyms=!1,updateMap()}),($selectLuredPokestopsOnly=$("#lured-pokestops-only-switch")).select2({placeholder:"Only Show Lured Pokestops",minimumResultsForSearch:1/0}),$selectLuredPokestopsOnly.on("change",function(){Store.set("showLuredPokestopsOnly",this.value),lastpokestops=!1,updateMap()}),($switchGymSidebar=$("#gym-sidebar-switch")).on("change",function(){Store.set("useGymSidebar",this.checked),lastgyms=!1,$.each(["gyms"],function(e,t){$.each(mapData[t],function(e,n){mapData[t][e].marker.rangeCircle&&(mapData[t][e].marker.rangeCircle.setMap(null),delete mapData[t][e].marker.rangeCircle),mapData[t][e].marker.setMap(null)}),mapData[t]={}}),updateMap()}),$selectSearchIconMarker=$("#iconmarker-style"),$selectLocationIconMarker=$("#locationmarker-style"),$.getJSON("static/dist/data/searchmarkerstyle.min.json").done(function(e){searchMarkerStyles=e;var t=[];$.each(e,function(e,n){t.push({id:e,text:n.name})}),$selectSearchIconMarker.select2({placeholder:"Select Icon Marker",data:t,minimumResultsForSearch:1/0}),$selectSearchIconMarker.on("change",function(e){var t=$selectSearchIconMarker.val();Store.set("searchMarkerStyle",t),updateSearchMarker(t)}),$selectSearchIconMarker.val(Store.get("searchMarkerStyle")).trigger("change"),updateSearchMarker(Store.get("lockMarker")),$selectLocationIconMarker.select2({placeholder:"Select Location Marker",data:t,minimumResultsForSearch:1/0}),$selectLocationIconMarker.on("change",function(e){Store.set("locationMarkerStyle",this.value),updateLocationMarker(this.value)}),$selectLocationIconMarker.val(Store.get("locationMarkerStyle")).trigger("change")})}),$(function(){function e(e){return e.id?$('<span><i class="pokemon-sprite n'+e.element.value.toString()+'"></i> '+e.text+"</span>"):e.text}function t(e,t,n){return function(){Store.set(n,this.checked),this.checked?("showPokemon"===n?lastpokemon=!1:"showPokestops"===n?lastpokestops=!1:"showScanned"===n?lastslocs=!1:"showSpawnpoints"===n&&(lastspawns=!1),updateMap()):"showGyms"===n||"showRaids"===n?Store.get("showGyms")||Store.get("showRaids")?(lastgyms=!1,updateMap()):$.each(t,function(t,n){$.each(e[n],function(t,a){e[n][t].marker.rangeCircle&&(e[n][t].marker.rangeCircle.setMap(null),delete e[n][t].marker.rangeCircle),e[n][t].marker.setMap(null)}),e[n]={}}):($.each(t,function(t,a){var o=[];$.each(e[a],function(t,i){e[a][t].marker.rangeCircle&&(e[a][t].marker.rangeCircle.setMap(null),delete e[a][t].marker.rangeCircle),"showRanges"!==n&&(e[a][t].marker.setMap(null),"pokemons"===a&&o.push(e[a][t].marker))}),"pokemons"===a&&markerCluster.removeMarkers(o),"showRanges"!==n&&(e[a]={})}),"showRanges"===n&&updateMap())}}moment.locale(language),Store.get("startAtUserLocation")&&centerMapOnLocation(),$.getJSON("static/dist/data/moves.min.json").done(function(e){moves=e}),$selectExclude=$("#exclude-pokemon"),$selectPokemonNotify=$("#notify-pokemon"),$selectRarityNotify=$("#notify-rarity"),$textPerfectionNotify=$("#notify-perfection");var n=493;$.getJSON("static/dist/data/pokemon.min.json").done(function(t){var n=[];$.each(t,function(e,t){if(e>493)return!1;var a=[];n.push({id:e,text:i8ln(t.name)+" - #"+e}),t.name=i8ln(t.name),t.rarity=i8ln(t.rarity),$.each(t.types,function(e,t){a.push({type:i8ln(t.type),color:t.color})}),t.types=a,idToPokemon[e]=t}),$selectExclude.select2({placeholder:i8ln("Select Pokémon"),data:n,templateResult:e}),$selectPokemonNotify.select2({placeholder:i8ln("Select Pokémon"),data:n,templateResult:e}),$selectRarityNotify.select2({placeholder:i8ln("Select Rarity"),data:[i8ln("Common"),i8ln("Uncommon"),i8ln("Rare"),i8ln("Very Rare"),i8ln("Ultra Rare")],templateResult:e}),$selectExclude.on("change",function(e){buffer=excludedPokemon,excludedPokemon=$selectExclude.val().map(Number),buffer=buffer.filter(function(e){return this.indexOf(e)<0},excludedPokemon),reincludedPokemon=reincludedPokemon.concat(buffer),clearStaleMarkers(),Store.set("remember_select_exclude",excludedPokemon)}),$selectPokemonNotify.on("change",function(e){notifiedPokemon=$selectPokemonNotify.val().map(Number),Store.set("remember_select_notify",notifiedPokemon)}),$selectRarityNotify.on("change",function(e){notifiedRarity=$selectRarityNotify.val().map(String),Store.set("remember_select_rarity_notify",notifiedRarity)}),$textPerfectionNotify.on("change",function(e){notifiedMinPerfection=parseInt($textPerfectionNotify.val(),10),(isNaN(notifiedMinPerfection)||notifiedMinPerfection<=0)&&(notifiedMinPerfection=""),notifiedMinPerfection>100&&(notifiedMinPerfection=100),$textPerfectionNotify.val(notifiedMinPerfection),Store.set("remember_text_perfection_notify",notifiedMinPerfection)}),$selectExclude.val(Store.get("remember_select_exclude")).trigger("change"),$selectPokemonNotify.val(Store.get("remember_select_notify")).trigger("change"),$selectRarityNotify.val(Store.get("remember_select_rarity_notify")).trigger("change"),$textPerfectionNotify.val(Store.get("remember_text_perfection_notify")).trigger("change"),isTouchDevice()&&isMobileDevice()&&$(".select2-search input").prop("readonly",!0)}),window.setInterval(updateLabelDiffTime,1e3),window.setInterval(updateMap,5e3),window.setInterval(updateGeoLocation,1e3),createUpdateWorker(),$("#gyms-switch").change(function(){var e={duration:500},n=$("#gym-sidebar-wrapper");this.checked?(lastgyms=!1,n.show(e)):(lastgyms=!1,n.hide(e));var a=$("#gyms-filter-wrapper");this.checked?(lastgyms=!1,a.show(e)):(lastgyms=!1,a.hide(e)),t(mapData,["gyms"],"showGyms").bind(this)()}),$("#raids-switch").change(function(){var e={duration:500},n=$("#raids-filter-wrapper");this.checked?(lastgyms=!1,n.show(e)):(lastgyms=!1,n.hide(e)),t(mapData,["gyms"],"showRaids").bind(this)()}),$("#pokemon-switch").change(function(){t(mapData,["pokemons"],"showPokemon").bind(this)()}),$("#scanned-switch").change(function(){t(mapData,["scanned"],"showScanned").bind(this)()}),$("#spawnpoints-switch").change(function(){t(mapData,["spawnpoints"],"showSpawnpoints").bind(this)()}),$("#ranges-switch").change(t(mapData,["gyms","pokemons","pokestops"],"showRanges")),$("#pokestops-switch").change(function(){var e={duration:500},n=$("#lured-pokestops-only-wrapper");return this.checked?(lastpokestops=!1,n.show(e)):(lastpokestops=!1,n.hide(e)),t(mapData,["pokestops"],"showPokestops").bind(this)()}),$("#sound-switch").change(function(){Store.set("playSound",this.checked);var e={duration:500},t=$("#pokemoncries");this.checked?t.show(e):t.hide(e)}),$("#cries-switch").change(function(){Store.set("playCries",this.checked)}),$("#geoloc-switch").change(function(){$("#next-location").prop("disabled",this.checked),$("#next-location").css("background-color",this.checked?"#e0e0e0":"#ffffff"),navigator.geolocation?Store.set("geoLocate",this.checked):this.checked=!1}),$("#lock-marker-switch").change(function(){Store.set("lockMarker",this.checked),searchMarker.setDraggable(!this.checked)}),$("#search-switch").change(function(){searchControl(this.checked?"on":"off")}),$("#start-at-user-location-switch").change(function(){Store.set("startAtUserLocation",this.checked)}),$("#follow-my-location-switch").change(function(){navigator.geolocation?Store.set("followMyLocation",this.checked):this.checked=!1,locationMarker.setDraggable(!this.checked)}),$("#scan-here-switch").change(function(){this.checked&&!Store.get("scanHereAlerted")&&(alert("Use this feature carefully ! This button will set the current map center as new search location. This may cause worker to teleport long range."),Store.set("scanHereAlerted",!0)),$("#scan-here").toggle(this.checked),Store.set("scanHere",this.checked)}),$("#nav-accordion").length&&$("#nav-accordion").accordion({active:0,collapsible:!0,heightStyle:"content"}),$("#pokemonList_table").DataTable({paging:!1,searching:!1,info:!1,errMode:"throw",language:{emptyTable:""},columns:[{orderable:!1},null,null,null]}).order([1,"asc"])});
//# sourceMappingURL=map.min.js.map